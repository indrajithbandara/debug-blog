---
layout: post
title:  "MongoDB!"
date:   2016-10-13 15:32:03 -0300
categories: start blog
---
## MongoDB

## Aula 1

###### NOSQL
Nos bancos relacionais o que importa são as respostas que voce tem, sabemos os dados que vao entrando, normalizando, separando todas
informacoes para nao ter duplicidade nas tabelas, só existe uma forma de modelar o relacional, normalizando, agora se vc for NoSQL
as perguntas que importam, o que o sistema quer no inicio dele

###### Terminologia
SQL RDBMS         MongoDB
DATABASE          DATABASE
TABLE             COLLECTION
ROWS              DOCUMENT JSON
QUERY             QUERY
INDEX             INDEX
PARTITION         SHARD

###### Vantagens
Normalmente as empresas utilizam os bancos NoSQL quando possuem um banco de dados em franco crescimento e precisam escalar horizontalmente com performance.

###### Tipos
Nesse universo de Banco de Dados NoSQL temos alguns grupos grandes com diversos bancos de dados e para as mais diversas finalidades, então vamos conhecer um pouco sobre eles para entender um pouco onde iremos nos enfiar. :p
Chave/Valor;
Documento;
Grafo;
Coluna.

##### Para iniciarmos o MongoDb precisamos rodar o seu serviço, executando o comando:
mongod

##### Caso seja sua primeira vez com o MongoDb e ter dado erro e você localizar isso na mensagem de erro:
data/db

##### Significa que sua pasta data/db não está criada, para criar em sistema unix e da as permissões necessárias use:
sudo mkdir /data
sudo mkdir /data/db
sudo chmod 777 -Rf /data'

###### Para conectarmos no servidor do MongoDb usaremos seu cliente, o:
mongo

###### Antes instale o Mongo Hacker para colocrir o console
https://github.com/TylerBrock/mongo-hacker

###### Para exportarmos os dados de uma coleção no MongoDb usaremos o comando: 
mongoexport

###### Chamamos o mongo export com  nome da database, nome da coleção a ser exportada, e  nome do arquivo Jason que vc quer salvar.
$ mongoxport --db nome_da_database --collection nome_da_colecao --out minha_colecao.json

##### mongoimport é mesma coisa, porem dessa vez temos o --drop que apaga sua colecao se ela existir e joga os dados em cima da colecao vazia,  e file eh o aquivo que tem os dados desse json
$ mongoimport --db database --collection collection --drop --file data.json

#### Exercicios 1
https://bitbucket.org/rxon7/be-mean-exercicios/commits/3d31141bcaa9d344a23f020c3c4fa9d935daa150

## ================================================= Aula 2

#### Utilizando databases
use nome_database

### Caso queria escolher uma database na hora de levantar o mongod basta executar
mongo nome_database

##### Então agora é sua hora de mudar seu banco de dados, vamos todos usar a mesma base:
use be-mean-instagram

##### Perceba que logo abaixo você receberá uma mensagem assim:
switched to db be-mean-instagram

###### Isso significa que agora nossa variável `db` está aprontando para nosso database, para você verificar basta digitar `db` e apertar o ENTER:Isso
$ db
be-mean-instagram

###### Rodando um show dbs agora sõ vamos consegui vê o local.
show dbs
local  0.078GB

###### Isso acontece porque o MongoDb só irá criar sua database quando você tiver inserido algo nela, para inserirmos algo faremos da seguinte maneira:
db.teste.insert({nome: "Suissa", idade: 30})
s})

###### Agora dando um show dbs vamos ve nossa datcoleçãoabase lá pq foi inserido um JSON nela.
$ show dbs
-be-mean          
→ 0.203GB
    
#### show collections  é o responsável por listar as coleções da sua database especificada com use.
show collections
invt           →  0.000MB /  0.008MB
pokemons       →  0.106MB /  0.246MB

###### Caso deseje criar uma coleção vazia você deverá usar o comando: 
db.createCollection()
https://docs.mongodb.org/v3.0/reference/method/db.createCollection/#db.createCollection


## db.insert() Create

##### Como vamos fazer um CRUD primeiro vamo fazer um Create, primeiro mudamos e criamos nossa nova database
use be-mean-teste

##### Vamos iniciar nossa coleção de Pokemons criado a variavel de inserção.
var pokemon = {'name':'RenanMon','description':'Rato elétrico bem fofinho','type': 'electric', attack: 55, height: 0.4 }

###### Agora damos o comando para inserir o Pikachu como primeiro.
db.pokemons.insert(pokemon)

##### Depois damos um find() e ele vai mostar o Renananzinho
db.pokemons.find()
{
  "_id": ObjectId("587e50a95a64ab4282a4698d"),
  "name": "RenanMon", 
}height}

###### Agora vamos adcione mais 3 pokemons.
var pokemons =  {'name':'Bulbassauro','description':'Chicote de trepadeira','type': 'grama', 'attack': 49, height: 0.4 }
var pokemons =  {'name':'Charmander','description':'Esse é o cão chupando manga de fofinho','type': 'fogo', 'attack': 52, height: 0.6 }
var pokemons =  {'name':'Squirtle','description':Ejeta água que passarinho não bebe','type': 'água', 'attack': 48, height: 0.5 }

##### Agora basta inserir todos eles
db.pokemons.insert(pokemon)

##### Depois de inserido todos os pokemons agora basta listá-los:
db.pokemons.find() 
{
  "_id": ObjectId("587e50a95a64ab4282a4698d"),
  "name": "RenanMon",}

{  "_id": ObjectId("587e70f25a64ab4282a46990"),
  "name": "Charmander",  }


### save() Insere e Salva

###### Vamos criar uma variavel pokemon que chma Caterpie
var pokemon = {'name':'Caterpie','description':'Larva lutadora','type': 'inseto', attack: 30, height: 0.3 }

###### Criamos o nosso Pokemon e tah aqui a variavel dele
$ pokemon
{  "name": "Caterpie",
  "description": "Larva lutadora",}

##### Agora que já temos a variavel pokemon basta salvar
$ db.pokemons.save(pokemon)
{
  "_id": ObjectId("587e50a95a64ab4282a4698d"),  }

{
  "_id": ObjectId("587ff5ddd567778181af4f54"),"name": "Caterpie",
}

### Buscando e Adcinando

##### Vamos criar uma query de busca, vamos modificar o Cartepie com um save, primeiramente criamos uma query:
$ var query = {name: 'Caterpie'}
$ var p = db.pokemons.find(query)
$ p
{  "_id": ObjectId("587ff5ddd567778181af4f54"),
  "name": "Caterpie",}

##### Se tentar-mos acessa-lo novamente ele nao existe mais pq vem em forma de cursor (para usar cursor busque documentacao)
$ p.name
> 
##### Então precisamos utilizar o findOne pois ele retorna um objeto comum, com a mesma query agora usando o findOne
$ var p = db.pokemons.findOne(query)

#### Agora podemos digitar a variavel p e fazer a busca quantas vezes quisermos
$ p
{  "_id": ObjectId("56422705613f89ac53a7b5d4"),
  "name": "Caterpie",  
}

##### Se usarmos o p.name agora funcioana normal
$ p.name 
Caterpie

### Modificando

##### Vamos adcionar defense 35 localmente e depois modificar
$ p.defense = 35
$ p
{  "_id": ObjectId("587ff5ddd567778181af4f54"),
  "defense": 35  }

###### aGORA VAmos salvar no banco, porém temos dois passos, mas com update ele só faz tudo de uma vez
$ db.pokemons.save(p)
Updated 1 existing record(s) in 225ms

##### Agora podemos vê que ele alterou de verdade
db.pokemons.find(query)
{  "_id": ObjectId("587ff5ddd567778181af4f54"),
  "name": "Caterpie",
    "defense": 35}

## Cursor

##### Primeiramente fazemos um find(), lembrando que o find() retorna o cursor e o findOne o objeto direto, depois vamos fazer um while nesse cursor
var cur = db.pokemons.find();

#### Fazemos um while onde se cursor tiver uma proxima posição(hasNext) ele vai imprimir { print(tojson) } e ai vamos pegar o nosso cursor com (cur.next) que é a funcao que pega o valor da proxima posicao, se ele tiver has next vc pode pegar o valor com  next
while( cur.hasNext() ) { print(tojson(cur.next()))};
{
  "_id": ObjectId("587e50a95a64ab4282a4698d"),
  "name": "RenanMon",
}
{
  "_id": ObjectId("587e70385a64ab4282a4698e"),
  "name": "Bulbassauro",
}

## Exercicios 2
https://bitbucket.org/rxon7/be-mean-exercicios/commits/e120b2fcbcd86500e4edbab0f937ebca27d7540b


#### ============================ Aula 3s

## Fizemos o C do Crud agora é o R do retrive, 
find() Retrieve

##### já mostramos o find e vamos mostrar o findOne também
findOne() Retrieve

###### _id UUID
Quando adcionamos qualquer atributo em nosso documento ele cria o _id UUID, e um indicador universal.

###### O _id trabalha separando quatro tipos de dados:
4-bytes: valor que representa os segundos desde a época Unix;
3-bytes: identificador de máquina;
2-bytes: ID do processo;
3-bytes: contador, começando com um valor aleatório.

##### Sintaxe, o find aceita dois parametros, pensando em forma relacional o primeira parametro eh o where e o segundo os campos (seria select)
db.colecao.find({clausulas}, {campos})

#### Para facilitar nossa vida iremos criar um JSON para nossa *query*, para isso iremos criar um JSON da seguinte forma:
var query = {name: 'Raticate'}

db.pokemons.find(query)
{  "_id": ObjectId("58813d046d9b4a4b7e1ecde8"),
  "name": "Raticate",}

##### Fields (campos)
Fildes é o nosso segundo parametro, se o nosso JSON de `query` é o WHERE do relacional, logo o JSON `fields` será o nosso SELECT onde o mesmo irá selecionar quais campos desejados na busca da query.
Para isso especificamos os campos desejados com 1 que significa TRUE ou os campos indesejados com 0 que significa FALSE.

###### Para facilitar vamos criar um json para nossa query da seguinte forma
var query = {name: 'Raticate'}

###### Nosso objeto de fields eh esse aqui, com name 1 e description 1
var fields = {name: 1, description: 1}

##### São esses dois objetos acima que precisamos para consluir a busca com find
db.pokemons.find(query, fields)
{
  "_id": ObjectId("58813d046d9b4a4b7e1ecde8"),
  "name": "Raticate",
  "description": "Renan gonsalves"
}

##### Ele retornou o atributo e tambem o _ID, para negar é só digitar _id: 0
var fields = {name: 1, description: 1, _id:0 }

##### Execultamos novamente veja que só veio o nome e o description
db.pokemons.find(query, fields)
{"name": "Raticate",
"description": "Renan gonsalves"}

## Operadores Aritméticos

###### Menor que
< é $lt
less than

###### Menor ou igual
<= é $lte
less than or equal

###### Maior que
> é $gt
greater than

###### Maior ou igual
>= é $gte
greater than or equal


##### Depois de especificamos qual campo vamos fazer a busca temos que passar o objeto para identificar qual operacao que vamos fazer nesse campo
var query = {height: {$lt: 0.5}}

##### Podemos vê que a busca está bem mais clara para um programador do que o SQL
query
{
  "height": {
    "$lt": 0.5
    }
}

##### Agora passamfazemos a nossa busca.
db.pokemons.find(query)
{  "_id": ObjectId("587e50a95a64ab4282a4698d"),
  "name": "RenanMon",}
{
  "_id": ObjectId("587e70385a64ab4282a4698e"),
  "name": "Bulbassauro",
}

## Operadores Lógicos

##### O primeiro é o nosso or(ou), se tiver duas ou mais primicias, se uma delas for verdadeira, retorna verdadeiro 
$or (OU)

###### Veja a nossa sintaxe, precisamos de duas premmissias para testar o operador logico, e esses objetos json é aceito pelo nosso 'or'  
var query = {$or: [{name: 'RenanMon'}, { height: 1.69 }]}

Retorna objetos caso a cláusula OU for verdadeira.

##### Vamos ve o que temos nessa query
db.pokemons.find(query)
{
  "_id": ObjectId("587e50a95a64ab4282a4698d"),
  "name": "RenanMon",
  "height": 0.4
}

Ou seja, se pelo menos 1 premissa for verdadeira ele irá retornar o objeto que contém essa premissa.

##### $nor Not OU

##### É a negação do OR, ou seja, retorna TODOS os objetos que não possuem as premissas buscadas. 
var query = {$nor: [{name: 'RenanMon'}, { height: 1.69 }]}

###### Ele tras todos menos o que veio no OR (no caso o RenanMon)
$ db.pokemons.find(query)
{ "_id": ObjectId("587e70385a64ab4282a4698e"),
     "height": 0.4}
{  "_id": ObjectId("587e70965a64ab4282a4698f"), 
  "height": 0.6}

#### $and E
Retorna objetos caso a cláusula E for verdadeira.

var query = {$and: [{name: 'RenanMon'}, { height: 0.4 }]}

### Vamos fazer o noss find, ele vai retornar pq as duas premissas sao verdadeiras
db.pokemons.find(query)
{
  "_id": ObjectId("587e50a95a64ab4282a4698d"),
  "name": "RenanMon",
  "description": "Renan gonsalves",
}

###### Operadores “Existênciais”
$exists

Como o mondo DB é steamaless vc nao tem uma estrutura pré definida da sua coleção
um operador desse tipo nos facilita muito a nossa busca para serto tipos de objeto que
nois necesitamos, muito usado para buscar tags em blogs, veremos exemplos mais para frente

##### Exercicio
#### ============================ Aula 4

var registerGames = [

    {name: "Prince of Persia: The Two Thrones", pwd: 25 , plataform: "ps3", velocista: 14, comments: "Um bug", online: "nao", Origiem: "comprado", guia: "s", platina: "nao" }
        
]
#### ============================ Aula 5

##













  
  
























---
layout: post
title:  "MongoDb NoSQL!"
date:   2016-05-14 14:42:55 -0300
categories: start blog
---
MongoDb é um banco não relacional, orientado a documentos e que trabalha com Json, vou abordar apenas alguns comandos basicos.


##### levantar o Servidor do MongoDb
npm install -g mongo-hacker

##### Depois dá as permições
sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}


##### levantar o Servidor do MongoDb
$ mongod

##### levantar o Client, onde vamos intgeragir com o servidor
mongo

#### Para deixar o console colorido instale o mongohacker
[MongoHacker](http://tylerbrock.github.io/mongo-hacker/)

##### Para exportarmos os dados de uma coleção usaremos o comando: mongoexport
mongoexport --db nome_do_database --collection nome_da_colecao --out minha_colecao.json

##### Para importar uma coleção de dados usaremos o comando: mongoimport
mongoimport --db database --collection collection --drop --file data.json

##### Para usar ou criar a dabase escolhida
use nome_database

##### Para escolher a database na hora de levandar o banco
mongo nome_database

##### Para listar as databases criadas
show dbs

##### Para listar as coleçõescolher
show collections

##### Dá o nome da database atual
db

##### Inserindo um objeto com variavel e um boolean
var json = {escola: 'Webschool', active:true}

##### Inserindo um objeto
db.teste.insert(json)

##### INSERT() CREATE

###### Para você conferir seu pokemon na sua coleção basta usar o comando find():
db.pokemons.find()


##### SAVE() INSERE E SALVA

###### Insere os dados
var pokemon = {'name':'Caterpie','description':'Larva lutadora','type': 'inseto', attack: 30, height: 0.3 }

##### Salva na tabela
db.pokemons.save(pokemon)


##### Modificando o objeto com a query

##### Criando a query de busca
 var query = {name: 'Caterpie'}
 
##### Utilizando o find com variavel
var p = db.pokemons.find(query)

### Se for buscar novamente ele está em cursor, faça:
db.pokemons.findOne()

###### Agora fazemos a busca
p.name = cartepie

###### Salvando do local para a maquina
db.pokemons.save(p)

###### Adicionadno valor ao caterpie localmente
p.defense = 35

##### Salvando no banco
db.pokemons.save(p)

#### Cursor

#### Primeiramente passando o find que retorna o cursor
var cur = db.pokemons.find();

#### Criamos uma funcao com while para pegar o cursor
while( cur.hasNext() ) { print(tojson(cur.next()))};


##### find() Retrieve
Já vimos o Create do CRUD agora é o R de retrive que busca informacoes na tabela

##### findOne() Retrieve
Além do find vamos também fazer busca com o findOne


#### _id UUID
O anderline ID é um indentificador unico e divide em 4 tipos de dados

##### O _id é formado pelos seguints dados:

4-bytes: valor que representa os segundos desde a época Unix;
3-bytes: identificador de máquina;
2-bytes: ID do processo;
3-bytes: contador, começando com um valor aleatório.



###### Sintaxe (As clausas seria o where no relacional e os campos o select)
db.colecao.find({clausulas}, {campos}) 


##### Query

Para facilitar nossa vida iremos criar um JSON para nossa *query*, para isso iremos criar um JSON da seguinte forma:

var query = {name: 'Pikachu'}



##### Depois passamos o Find dela, muito simples, veja filds no proximo exemplo
db.pokemons.find(query)

{
  "_id": ObjectId("5716d2c1cd4f60b059760d77"),
  "name": "Pikachu",
  "description": "Rato elétrico bem fofinho",
  "type": "electric",
  "attack": 55,
  "height": 0.4
}

##### Fields
Se o nosso JSON de `query` é o WHERE do relacional, logo o JSON `fields` será o nosso SELECT
onde o mesmo irá selecionar quais campos desejados na busca da query.


Para isso especificamos os campos desejados com 1 que significa TRUE ou os campos indesejados com 0 que significa FALSE

##### Criamos nosa query de busca
 var query = {name: 'Pikachu'}


##### Depois o nosso fields passando true(1)
var fields = {name: 1, description: 1}


### E colhemos o resultado:
{
  "_id": ObjectId("573e21a8cd692ddb1d87f46f"),
  "name": "Pikachu",
  "description": "Rato elétrico bem fofinho"
}

##### Para a busca nao vim com _ID só fazer 
var fields = {name: 1, description: 1, _id: 0}

#### Operadores Aritméticos


##### Ao ives de voce usar o menor que usa:
< é $lt - (less than)

##### Menor e igual
<= é $lte - (less than or equal)

##### Maior que é 
> é $gt - (greater than)

#### E maio e igual 
>= é $gte (greater than or equal)

#### Passamos o campo e os valores a serem buscados
var query = {height: {$lt:  0.5}}

#### Depois passamos nossa query para a funcao find
db.pokemons.find(query)

##### Operadores Lógicos

### $or OU
Se um objeto for verdadeiro ele retorna o verdadeiro


#### Fazemos a buca de um pokemon que tenha o nome pikachu ou altura de 1.69
var query = {$or: [{name: 'Pikachu'}, {height: 1.69}]}

##### Passando o find no array do or.
db.pokemons.find(query)
{
  "_id": ObjectId("5716d2c1cd4f60b059760d77"),
  "name": "Pikachu",
   "height": 0.4
}


##### Como nós temos o or temos também o not or que é a negação e trás todos menos o or.
{
  "_id": ObjectId("573e52ac3dafdc2715303b88"),
  "name": "Bulbassauro",
  "description": "Chicote de trepadeira",
  "type": "grama",
  "attack": 49,
  "height": 0.4
}


###### $and E 
var query = {$and: [{name: 'Pikachu'}, {height: 0.4}]}

#### Passsamos o find e como ele satifaz todas as clausulas
db.pokemons.find(query)

{
  "_id": ObjectId("5716d2c1cd4f60b059760d77"),
  "name": "Pikachu",
  "description": "Rato elétrico bem fofinho",
  "type": "electric",
  "attack": 55,
  "height": 0.4
}


##### Operadores “Existênciais”

### $exists - Retorna o objeto caso o campo exista, muito usado em tags
db.collection.find( { campo : { $exists : true } } );


------ Aula 4
##### update() Update

Para alteramos um documento no MongoDb possuímos duas formas:

- save
- update.


Para utilizar o save eu preciso antes buscar o documento necessário antes de poder
modificá-lo, com o update isso não será necessário.


A função update recebe 3 parâmetros:

- query
- modificação
- options


##### Sintaxe
db.colecao.update(query, mod, options);


#### Para iniciarmos vamos criar um Pokemon novo:
var poke = {name: "Testemon", attack: 8000, defense: 8000, height: 2.1, description: "Pokemon de teste"}

###### Passando o nosso poke
db.pokemons.save(poke)

#####  Fazendo a busca

#### Vamos fazer uma quenry para buscar pelo ID
var query = {name: /testemon/i}

##### Fazendo a busca para pegar o ID
db.pokemons.find(query)

{"_id": ObjectId("5746033c58abe728c2796cb8"),
"name": "Testemon", }

##### Colamos aqui o nosso ID e vamos buscar por ele
var query = {"_id": ObjectId("5746033c58abe728c2796cb8")}

#### Vamos fazer o nosso primeiro update
var mod = {description: "Mudei aqui mermaoooo"}

### Fazemos o update na coleção pokemons
db.pokemons.update(query, mod)

### Conferindo o nosso modoficado
db.pokemons.find(query)

{"_id": ObjectId("5746033c58abe728c2796cb8"),
"description": "Mudei aqui mermaoooo"}

###### Operadores de Modificação

##### $set

O operador $set modifica um valor ou cria ele, caso não exista.

#### Sintaxe
{ $set : { campo : valor } }


### Exemplos da sintaxe procurando o picachu e setando o attack para 120
db.pokemons.update( { name: 'Pikachu'}, { $set: { attack: 120
} } );


Então vamos reaproveitar nossa query que já possui nosso _id e vamos adicionar agora os campos faltantes e arrumar a description

#### Nosso objeto de alteração
var mod = {$set: {name: 'Testemon', attack: 8000, defense: 8000, height: 2.1, description: "Pokemon de teste"}}var


#### Agora passamos nossa query e o objeto de modificacao no update
db.pokemons.update(query, mod)


###### Alem de alterar os valores ele adiciona campos que nao existiam 
db.pokemons.find(query)
{
  "_id": ObjectId("5746033c58abe728c2796cb8"),
  "attack": 8000,
  "defense": 8000,
  "description": "Pokemon de teste",
  "height": 2.1,
  "name": "Testemon"
}


### $unset

# Operador para remover os campos, que é o caso do $unset.
var mod = {$unset: {height: 1}}

##### Verificamos que altura foi mandado para o espaço
db.pokemons.update(query, mod)

{
  "_id": ObjectId("5746033c58abe728c2796cb8"),
  "attack": 8000,
  "defense": 8000,
  "description": "Pokemon de teste",
  "name": "Testemon"
}


















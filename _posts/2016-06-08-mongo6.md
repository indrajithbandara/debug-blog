---
layout: post
title:  "MongoDb aula 6!"
date:   2016-08-06 13:33:55 -0300
categories: start blog
---


### Relacionamentos

Não existe JOINS!!!
Então vc nao consegue fazer algo com uma chave estrangeira, e fazer um join e fazer essa busca automatica
de dois dados em coleçoes separadas, por exemplo, nao existe de forma automatica

## Manual
Existe duas formas, a manual eh a amais usada e eh a que vamos utilizar.
Para fazer um relacionamento manual basta você salvar o _id de uma coleção em outra. Por exemplo vamos criar nosso inventário de pokemons pegos nas suas pokebolas.

### Vamos criar o nosso array com tres obejetos de pokemons e vamos colocar no jason a ser inserido no nosso inventario
var pokemons = [
  {"_id": ObjectId("564b1dad25337263280d0479")},
  { "_id": ObjectId("564b1dad25337263280d047a")},
  {"_id": ObjectId("564b1dad25337263280d047b")}
];

## Vamos fazr um json bem simples, que o nome eh pokemons e que tem um campo pokemons que eh um array com ID dos pokemons da nossa colecao
var json = {
  name: "Meus pokemons",
  pokemons: pokemons,
  
}

#### Agora basta inserir eles, passando o json inventario
db.invt.insert(json)

## Vamos fazer uma busca para vê a nossa coleão inventarios.
db.invt.findOne()
{"_id": ObjectId("564b1dad25337263280d047a")
 {
  "_id": ObjectId("564b1dad25337263280d047b")
} }
 
##### Depois de inserido nossos pokemons vamos criar a busca para pegar cada um COMO UM SELECT

# Primiro criamos um array vazi e Depois criamos uma funcao chamada getpokemon.
var pokemons = []

## Essa funcao recebe esse ID e vai fazer o findOne e o push no nosso array de pokemons
var getPokemon = function(id){ pokemons.push(db.pokemons.findOne(id)) }

## Entao basta que fazemos o findOne no inventario
var invt = db.invt.findOne()

## Chamando nosso inventario temos um array chamado pokemons
invt
{"pokemons": 
[{"_id": ObjectId("564b1dad25337263280d0479")
  },{
    "_id": ObjectId("564b1dad25337263280d047a")
},]

### Entao podemos fazer um forEach, que eh um for interando so nos elemenos do array, e ele aceita a funcao getPokemon 
invt.pokemons.forEach(getPokemon)

# Agora vamos vê o nosso pokemons que estava vazio e que acabamos de criar.
pokemons
{"_id": ObjectId("564b1dad25337263280d047a"),
   "created": "2013-11-03T15:05:41.271082",
   "types": ["fire" ] },
{
  "_id": ObjectId("564b1dad25337263280d047b"),
 "hp": 58,
 "name": "Charmeleon",
 "types": ["fire" ]
}]

### DBRef
A outra forma que temo de referencia documentos no Mongodb é utilizando o dbref, ele nada mais eh que
uma convenção para representar um documento relacionado, isso inclui:


- $ref: nome da coleção a ser referenciada;
- $id: o ObjectId do documento referenciado;
- $db: a database onde a coleção referenciada se encontra.





